<div class="flex h-screen bg-gray-50">
  <!-- Sidebar -->
  <div class="w-64 bg-white shadow-sm border-r border-gray-200 flex flex-col">
    <!-- Header -->
    <div class="p-6 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-xl font-bold text-gray-900">Admin Portal</h1>
          <p class="text-sm text-gray-600 mt-1">{{currentUser?.firstName}} {{currentUser?.lastName}}</p>
        </div>
        <div class="bg-gradient-to-r from-red-600 to-pink-600 text-white p-2 rounded-lg">
          <img src="assets/icons/lucide/lucide/shield.svg" alt="shield" class="w-4 h-4" />
        </div>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
      <!-- Main Navigation Tabs -->
      <button
        *ngFor="let tab of availableNavigationTabs"
        (click)="setActiveTabSafe(tab.id)"
        [class]="'w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors ' + 
          (activeTab === tab.id
            ? 'bg-red-50 text-red-700 border border-red-200'
            : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900')">
        <img [src]="'assets/icons/lucide/lucide/' + tab.icon + '.svg'" [alt]="tab.icon" class="w-5 h-5 mr-3" />
        <span class="font-medium">{{tab.label}}</span>
        <span *ngIf="tab.id === 'skill-approvals' && pendingSkillApprovalsCount > 0" 
              class="ml-auto bg-red-100 text-red-700 px-2 py-0.5 rounded-full text-xs">
          {{pendingSkillApprovalsCount}}
        </span>
      </button>
    </nav>

    <!-- Stats Summary -->
    <div class="p-4 border-t border-gray-200">
      <div class="space-y-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <div class="p-2 rounded-lg bg-red-50">
              <img src="assets/icons/lucide/lucide/alert-circle.svg" alt="pending" class="w-4 h-4 text-red-600" />
            </div>
            <span class="ml-3 text-sm font-medium text-gray-700">Pending Approvals</span>
          </div>
          <span class="text-lg font-bold text-gray-900">{{pendingSkillApprovalsCount}}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col overflow-hidden">
    <!-- Content Header -->
    <div class="bg-white border-b border-gray-200 px-6 py-4">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-2xl font-bold text-gray-900">
            {{activeTab === 'overview' ? 'Platform Overview' :
              activeTab === 'skill-approvals' ? 'Vendor Skill' :
              activeTab === 'skills' ? 'Skill Management' :
              activeTab === 'categories' ? 'Category Management' :
              activeTab === 'applications' ? 'All Applications' :
              activeTab === 'users' ? 'User Management' :
              activeTab === 'workflows' ? 'Workflow Management' :
              'Reports & Analytics'}}
          </h2>
          <p class="text-gray-600 mt-1">
            {{activeTab === 'overview' ? 'Monitor platform performance and key metrics' :
              activeTab === 'skill-approvals' ? 'Review and approve vendor skill submissions' :
              activeTab === 'skills' ? 'Manage platform skills and categories' :
              activeTab === 'categories' ? 'Manage platform categories' :
              activeTab === 'applications' ? 'View all applications from vendors and clients' :
              activeTab === 'users' ? 'Manage all platform users and permissions' :
              activeTab === 'workflows' ? 'Configure and manage application workflows' :
              'Comprehensive analytics and reporting dashboard'}}
          </p>
        </div>
        <div class="flex items-center space-x-3">
          <!-- Logout Button Only -->
          <button
            (click)="logout()"
            class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-all duration-200 flex items-center">
            <img src="assets/icons/lucide/lucide/log-out.svg" alt="logout" class="w-4 h-4 mr-2" />
            Logout
          </button>
        </div>
      </div>
    </div>

    <!-- Content Area -->
    <div class="flex-1 overflow-y-auto p-6">
      <!-- Overview Tab -->
      <app-admin-overview 
        *ngIf="activeTab === 'overview'"
        [skillApprovals]="skillApprovals"
        [platformStats]="platformStats">
      </app-admin-overview>

      <!-- Skill Approvals Tab -->
      <app-skill-approvals 
        *ngIf="activeTab === 'skill-approvals'"
        [skillApprovals]="skillApprovals"
        [skillApprovalFilter]="skillApprovalFilter"
        [paginationState]="skillApprovalsPaginationState"
        (filterChange)="onFilterChange()"
        (pageChange)="onSkillApprovalsPageChange($event)"
        (openApprovalModal)="openSkillApprovalModal($event)"
        (openRejectModal)="openSkillRejectModal($event)">
      </app-skill-approvals>

      <!-- Skills Tab -->
      <app-skills-management 
        *ngIf="activeTab === 'skills'"
        [adminSkills]="adminSkills"
        [categories]="categories"
        [isLoading]="loadingStates.skills"
        (editSkill)="editSkill($event)"
        (skillUpdated)="onSkillUpdated($event)"
        (openAddModal)="showAddSkillModal = true">
      </app-skills-management>

      <!-- Categories Tab -->
      <app-categories-management 
        *ngIf="activeTab === 'categories'"
        [categories]="categories"
        [isLoading]="loadingStates.categories"
        (openAddModal)="showAddCategoryModal = true"
        (openEditModal)="editCategory($event)"
        (categoryUpdated)="onCategoryUpdated($event)"
        (categoryAdded)="onCategoryAdded($event)">
      </app-categories-management>

      <!-- Applications Tab -->
      <app-applications-view 
        *ngIf="activeTab === 'applications'"
        [applications]="allApplications"
        [paginationState]="applicationsPaginationState"
        (pageChange)="onApplicationsPageChange($event)"
        (statusUpdate)="onApplicationStatusUpdate($event)">
      </app-applications-view>

      <!-- Users Tab -->
      <app-users-management 
        *ngIf="activeTab === 'users'"
        [users]="allUsers"
        [paginationState]="usersPaginationState"
        (pageChange)="onUsersPageChange($event)"
        (editUser)="editUser($event)"
        (toggleUserStatus)="toggleUserStatus($event)">
      </app-users-management>

      <!-- Reports Tab -->
      <app-admin-reports 
        *ngIf="activeTab === 'reports'">
      </app-admin-reports>

      <!-- Workflow Management Tab -->
      <app-workflow-management 
        *ngIf="activeTab === 'workflows'">
      </app-workflow-management>

      <!-- User Profile Tab -->
      <app-profile-dashboard 
        *ngIf="activeTab === 'user-profile'"
        [userId]="selectedUserForProfile?._id"
        [isAdminView]="true"
        [refreshTrigger]="profileRefreshTrigger"
        (backToUsers)="backToUsers()"
        (approveUser)="approveUserFromProfile($event)"
        (rejectUser)="rejectUserFromProfile($event.user, $event.notes)"
        (toggleUserStatus)="toggleUserStatus($event)">
      </app-profile-dashboard>
    </div>
  </div>

  <!-- Add Skill Modal -->
  <app-add-admin-skill-modal 
    *ngIf="showAddSkillModal" 
    (close)="showAddSkillModal = false"
    (skillAdded)="onSkillAdded($event)">
  </app-add-admin-skill-modal>

  <!-- Add Category Modal -->
  <app-add-category-modal 
    *ngIf="showAddCategoryModal" 
    (close)="showAddCategoryModal = false"
    (categoryAdded)="onCategoryAdded($event)">
  </app-add-category-modal>

  <!-- Edit Category Modal -->
  <app-edit-category-modal
    *ngIf="showEditCategoryModal"
    [category]="selectedCategoryForEdit"
    [isLoading]="loadingStates.categories"
    (save)="onEditCategorySave($event)"
    (cancel)="closeEditCategoryModal()">
  </app-edit-category-modal>

  <!-- Skill Approval Modal -->
  <div *ngIf="showSkillApprovalModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Approve Vendor Skill</h3>
        <button (click)="closeSkillApprovalModal()" class="text-gray-400 hover:text-gray-600">
          <img src="assets/icons/lucide/lucide/x.svg" alt="close" class="w-5 h-5" />
        </button>
      </div>
      <div class="p-6">
        <div *ngIf="selectedVendorSkill" class="mb-4">
          <p class="text-sm text-gray-600 mb-2"><strong>Skill:</strong> {{selectedVendorSkill.skill.name}}</p>
          <p class="text-sm text-gray-600 mb-2"><strong>Vendor:</strong> {{selectedVendorSkill.vendor.firstName}} {{selectedVendorSkill.vendor.lastName}}</p>
          <p class="text-sm text-gray-600 mb-2"><strong>Experience:</strong> {{selectedVendorSkill.yearsOfExperience}} years</p>
          <p class="text-sm text-gray-600 mb-4"><strong>Proficiency:</strong> {{selectedVendorSkill.proficiency}}</p>
        </div>
        <p class="text-sm text-gray-600 mb-4">Are you sure you want to approve this vendor skill?</p>
        <div class="flex justify-end space-x-3">
          <button (click)="closeSkillApprovalModal()" 
                  class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200">
            Cancel
          </button>
          <button (click)="approveSkill(selectedVendorSkill?._id || '')" 
                  class="px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700">
            Approve
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Skill Reject Modal -->
  <div *ngIf="showSkillRejectModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Reject Vendor Skill</h3>
        <button (click)="closeSkillRejectModal()" class="text-gray-400 hover:text-gray-600">
          <img src="assets/icons/lucide/lucide/x.svg" alt="close" class="w-5 h-5" />
        </button>
      </div>
      <div class="p-6">
        <div *ngIf="selectedVendorSkill" class="mb-4">
          <p class="text-sm text-gray-600 mb-2"><strong>Skill:</strong> {{selectedVendorSkill.skill.name}}</p>
          <p class="text-sm text-gray-600 mb-2"><strong>Vendor:</strong> {{selectedVendorSkill.vendor.firstName}} {{selectedVendorSkill.vendor.lastName}}</p>
          <p class="text-sm text-gray-600 mb-2"><strong>Experience:</strong> {{selectedVendorSkill.yearsOfExperience}} years</p>
          <p class="text-sm text-gray-600 mb-4"><strong>Proficiency:</strong> {{selectedVendorSkill.proficiency}}</p>
        </div>
        <div class="mb-4">
          <label for="rejectNotes" class="block text-sm font-medium text-gray-700 mb-2">Rejection Reason *</label>
          <textarea 
            id="rejectNotes"
            [(ngModel)]="skillRejectNotes" 
            rows="3" 
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"
            placeholder="Please provide a reason for rejection..."></textarea>
        </div>
        <div class="flex justify-end space-x-3">
          <button (click)="closeSkillRejectModal()" 
                  class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200">
            Cancel
          </button>
          <button (click)="rejectSkill(selectedVendorSkill?._id || '', skillRejectNotes)" 
                  [disabled]="!isSkillRejectNotesValid()"
                  class="px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed">
            Reject
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Application History Modal -->
  <app-application-history-modal
    [applicationId]="selectedApplicationId"
    [isVisible]="showHistoryModal"
    [isLoading]="false"
    [history]="applicationHistory"
    (close)="closeHistoryModal()">
  </app-application-history-modal>

</div>