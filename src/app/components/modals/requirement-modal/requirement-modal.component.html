<div class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 z-50">
  <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-gray-100">
    <!-- Enhanced Header -->
    <div class="relative bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-t-2xl p-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="p-2 bg-white bg-opacity-20 rounded-lg">
            <img src="assets/icons/lucide/lucide/briefcase.svg" alt="requirement" class="w-6 h-6" />
          </div>
          <div>
            <h2 class="text-2xl font-bold">
              {{ mode === 'create' ? 'Post New Requirement' :
                 mode === 'edit' ? 'Edit Requirement' :
                 'Close Requirement' }}
            </h2>
            <p class="text-purple-100 text-sm mt-1">
              {{ mode === 'create' ? 'Create a new job requirement' :
                 mode === 'edit' ? 'Update requirement details' :
                 'Close this requirement permanently' }}
            </p>
          </div>
        </div>
        <button
          (click)="onClose()"
          class="p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-lg transition-all duration-200">
          <img src="assets/icons/lucide/lucide/x.svg" alt="x" class="w-6 h-6" />
        </button>
      </div>
    </div>

    <!-- Close Mode -->
    <div *ngIf="mode === 'close'" class="p-8">
      <div class="mb-6">
        <p class="text-gray-600 mb-4 text-lg">
          Are you sure you want to close the requirement "<strong class="text-purple-600">{{requirement?.title}}</strong>"?
        </p>
        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-xl p-6">
          <div class="flex">
            <img src="assets/icons/lucide/lucide/triangle-alert.svg" alt="alert-triangle" class="w-6 h-6 text-yellow-600 mr-3 flex-shrink-0 mt-0.5" />
            <div class="text-sm text-yellow-800">
              <p class="font-semibold mb-2 text-base">This action cannot be undone.</p>
              <ul class="list-disc list-inside space-y-1">
                <li>The requirement will be marked as closed</li>
                <li>No new applications will be accepted</li>
                <li>Existing applications will remain unchanged</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="flex items-center justify-end space-x-4">
        <button
          (click)="onClose()"
          class="px-6 py-3 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-all duration-200 font-semibold">
          Cancel
        </button>
        <button
          (click)="onSubmit()"
          class="px-6 py-3 bg-gradient-to-r from-red-600 to-pink-600 text-white rounded-xl hover:from-red-700 hover:to-pink-700 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
          <span class="flex items-center">
            <img src="assets/icons/lucide/lucide/lock.svg" alt="close" class="w-4 h-4 mr-2" />
            Close Requirement
          </span>
        </button>
      </div>
    </div>

    <!-- Create/Edit Mode -->
    <form *ngIf="mode === 'create' || mode === 'edit'" [formGroup]="requirementForm" (ngSubmit)="onSubmit()" class="p-8 space-y-8">
      <!-- Basic Information Section -->
      <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100">
        <div class="flex items-center space-x-2 mb-4">
          <img src="assets/icons/lucide/lucide/file-text.svg" alt="requirement" class="w-5 h-5 text-blue-600" />
          <h3 class="text-lg font-semibold text-gray-800">Basic Information</h3>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-2">
            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
              <img src="assets/icons/lucide/lucide/tag.svg" alt="title" class="w-4 h-4 mr-2 text-blue-600" />
              Requirement Title *
            </label>
            <input
              type="text"
              formControlName="title"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm"
              placeholder="e.g., Senior React Developer"
              required>
            <div *ngIf="requirementForm.get('title')?.invalid && requirementForm.get('title')?.touched" class="text-red-500 text-xs mt-1">
              Title is required
            </div>
          </div>

          <div class="space-y-2">
            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
              <img src="assets/icons/lucide/lucide/folder.svg" alt="category" class="w-4 h-4 mr-2 text-blue-600" />
              Category *
            </label>
            <select
              formControlName="category"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm"
              required>
              <option value="">Select a category</option>
              <option *ngFor="let category of availableCategories" [value]="category._id">
                {{category.name}}
              </option>
            </select>
            <div *ngIf="requirementForm.get('category')?.invalid && requirementForm.get('category')?.touched" class="text-red-500 text-xs mt-1">
              Category is required
            </div>
          </div>

          <div class="space-y-2">
            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
              <img src="assets/icons/lucide/lucide/map-pin.svg" alt="location" class="w-4 h-4 mr-2 text-purple-600" />
              Location *
            </label>
            <input
              type="text"
              formControlName="location"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm"
              placeholder="e.g., New York, NY"
              required>
            <div *ngIf="requirementForm.get('location')?.invalid && requirementForm.get('location')?.touched" class="text-red-500 text-xs mt-1">
              Location is required
            </div>
          </div>
        </div>
      </div>

      <!-- Skills Section -->
      <div class="bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl p-6 border border-orange-100">
        <div class="flex items-center space-x-2 mb-4">
          <img src="assets/icons/lucide/lucide/award.svg" alt="skills" class="w-5 h-5 text-orange-600" />
          <h3 class="text-lg font-semibold text-gray-800">Required Skills *</h3>
        </div>
        
        <div class="space-y-3" formArrayName="skills">
          <div *ngFor="let skill of skills.controls; let i = index" class="flex items-center space-x-3">
            <select
              [formControlName]="i"
              class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm"
              required>
              <option value="">Select a skill</option>
              <option *ngFor="let adminSkill of availableSkills" [value]="getSkillId(adminSkill)">
                {{adminSkill.name}}
              </option>
            </select>
            <button
              *ngIf="skills.length > 1"
              type="button"
              (click)="removeSkill(i)"
              class="p-3 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-xl transition-all duration-200">
              <img src="assets/icons/lucide/lucide/minus.svg" alt="minus" class="w-5 h-5" />
            </button>
          </div>
          <button
            type="button"
            (click)="addSkill()"
            class="flex items-center text-orange-600 hover:text-orange-700 text-sm font-semibold p-2 hover:bg-orange-50 rounded-lg transition-all duration-200">
            <img src="assets/icons/lucide/lucide/plus.svg" alt="plus" class="w-4 h-4 mr-2" />
            Add Skill
          </button>
        </div>
        <div *ngIf="availableSkills.length === 0" class="text-xs text-orange-600 mt-2 flex items-center">
          <img src="assets/icons/lucide/lucide/loader-2.svg" alt="loading" class="w-3 h-3 mr-1 animate-spin" />
          Loading skills...
        </div>
        <div *ngIf="requirementForm.get('skills')?.invalid && requirementForm.get('skills')?.touched" class="text-red-500 text-xs mt-1">
          At least one skill is required
        </div>
        <p class="text-xs text-gray-600 mt-2 flex items-center">
          <img src="assets/icons/lucide/lucide/info.svg" alt="info" class="w-3 h-3 mr-1" />
          Skills are managed by administrators. Contact admin to add new skills.
        </p>
      </div>

      <!-- Experience & Budget Section -->
      <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-100">
        <div class="flex items-center space-x-2 mb-4">
          <img src="assets/icons/lucide/lucide/briefcase.svg" alt="experience" class="w-5 h-5 text-green-600" />
          <h3 class="text-lg font-semibold text-gray-800">Experience & Budget</h3>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div formGroupName="experience" class="space-y-4">
            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
              <img src="assets/icons/lucide/lucide/clock.svg" alt="experience" class="w-4 h-4 mr-2 text-green-600" />
              Required Experience *
            </label>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <input
                  type="number"
                  formControlName="minYears"
                  min="0"
                  max="50"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm"
                  placeholder="Years"
                  required>
                <div *ngIf="experience.get('minYears')?.invalid && experience.get('minYears')?.touched" class="text-red-500 text-xs mt-1">
                  Years of experience is required
                </div>
              </div>
              <div>
                <select
                  formControlName="level"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm"
                  required>
                  <option value="junior">Junior</option>
                  <option value="mid">Mid</option>
                  <option value="senior">Senior</option>
                  <option value="expert">Expert</option>
                </select>
                <div *ngIf="experience.get('level')?.invalid && experience.get('level')?.touched" class="text-red-500 text-xs mt-1">
                  Experience level is required
                </div>
              </div>
            </div>
          </div>

          <div formGroupName="budget" class="space-y-4">
            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
              <img src="assets/icons/lucide/lucide/dollar-sign.svg" alt="budget" class="w-4 h-4 mr-2 text-green-600" />
              Budget ($/hour) *
            </label>
            <div>
              <input
                type="number"
                formControlName="charge"
                min="1"
                max="500"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm"
                placeholder="Hourly rate"
                required>
              <div *ngIf="requirementForm.get('budget')?.get('charge')?.invalid && requirementForm.get('budget')?.get('charge')?.touched" class="text-red-500 text-xs mt-1">
                Budget is required
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Project Details Section -->
      <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-100">
        <div class="flex items-center space-x-2 mb-4">
          <img src="assets/icons/lucide/lucide/calendar.svg" alt="project" class="w-5 h-5 text-purple-600" />
          <h3 class="text-lg font-semibold text-gray-800">Project Details</h3>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div formGroupName="timeline" class="space-y-4">
            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
              <img src="assets/icons/lucide/lucide/clock.svg" alt="timeline" class="w-4 h-4 mr-2 text-purple-600" />
              Timeline *
            </label>
            <div class="space-y-3">
              <input
                type="number"
                formControlName="duration"
                min="1"
                max="36"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm"
                placeholder="Duration in months"
                required>
              <div *ngIf="timeline.get('duration')?.invalid && timeline.get('duration')?.touched" class="text-red-500 text-xs mt-1">
                Duration is required (1-36 months)
              </div>
              <input
                type="date"
                formControlName="start_date"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm"
                placeholder="Start date">
            </div>
          </div>

          <div formGroupName="work_preference" class="space-y-4">
            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
              <img src="assets/icons/lucide/lucide/map-pin.svg" alt="work" class="w-4 h-4 mr-2 text-purple-600" />
              Work Preference *
            </label>
            <div class="space-y-3">
              <div class="flex items-center p-3 bg-white rounded-xl border border-gray-300">
                <input
                  type="checkbox"
                  formControlName="remote"
                  class="h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                <label class="ml-3 block text-sm font-medium text-gray-700">
                  Remote work acceptable
                </label>
              </div>
              <div class="flex items-center p-3 bg-white rounded-xl border border-gray-300">
                <input
                  type="checkbox"
                  formControlName="onsite"
                  class="h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                <label class="ml-3 block text-sm font-medium text-gray-700">
                  On-site work acceptable
                </label>
              </div>
              <div class="flex items-center p-3 bg-white rounded-xl border border-gray-300">
                <input
                  type="checkbox"
                  formControlName="hybrid"
                  class="h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                <label class="ml-3 block text-sm font-medium text-gray-700">
                  Hybrid work acceptable
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Description Section -->
      <div class="bg-gradient-to-r from-teal-50 to-cyan-50 rounded-xl p-6 border border-teal-100">
        <div class="flex items-center space-x-2 mb-4">
          <img src="assets/icons/lucide/lucide/file-text.svg" alt="description" class="w-5 h-5 text-teal-600" />
          <h3 class="text-lg font-semibold text-gray-800">Description *</h3>
        </div>
        
        <textarea
          formControlName="description"
          rows="4"
          class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm resize-none"
          placeholder="Detailed description of the requirement, project scope, and expectations..."
          required></textarea>
        <div *ngIf="requirementForm.get('description')?.invalid && requirementForm.get('description')?.touched" class="text-red-500 text-xs mt-1">
          Description is required
        </div>
      </div>

      <!-- File Upload Section -->
      <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl p-6 border border-indigo-100">
        <div class="flex items-center space-x-2 mb-4">
          <img src="assets/icons/lucide/lucide/paperclip.svg" alt="attachment" class="w-5 h-5 text-indigo-600" />
          <h3 class="text-lg font-semibold text-gray-800">Attach Document (Optional)</h3>
        </div>
        
        <div class="space-y-4">
          <!-- Existing File Display (Edit Mode) -->
          <div *ngIf="mode === 'edit' && requirement?.attachment" class="flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-xl">
            <div class="flex items-center space-x-3">
              <img src="assets/icons/lucide/lucide/file-text.svg" alt="file" class="w-6 h-6 text-blue-600" />
              <div>
                <p class="text-sm font-semibold text-blue-800">{{ requirement?.attachment?.originalName || 'Unknown file' }}</p>
                <p class="text-xs text-blue-600">{{ (requirement?.attachment?.fileSize || 0) / 1024 / 1024 | number:'1.2-2' }} MB</p>
                <p class="text-xs text-blue-500">Current attachment</p>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <button
                type="button"
                (click)="downloadFile(requirement?.attachment)"
                class="p-2 text-blue-600 hover:text-blue-700 hover:bg-blue-100 rounded-lg transition-all duration-200"
                title="Download file">
                <img src="assets/icons/lucide/lucide/download.svg" alt="download" class="w-4 h-4" />
              </button>
              <button
                type="button"
                (click)="removeExistingFile()"
                class="p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-all duration-200"
                title="Remove file">
                <img src="assets/icons/lucide/lucide/x.svg" alt="remove" class="w-4 h-4" />
              </button>
            </div>
          </div>

          <!-- File Input -->
          <div class="flex items-center justify-center w-full">
            <label 
              for="requirement-file-upload" 
              class="flex flex-col items-center justify-center w-full h-32 border-2 border-indigo-300 border-dashed rounded-xl cursor-pointer bg-white hover:bg-indigo-50 transition-all duration-200">
              <div class="flex flex-col items-center justify-center pt-5 pb-6">
                <img src="assets/icons/lucide/lucide/upload.svg" alt="upload" class="w-10 h-10 mb-3 text-indigo-400" />
                <p class="mb-2 text-sm text-gray-600">
                  <span class="font-semibold text-indigo-600">Click to upload</span> or drag and drop
                </p>
                <p class="text-xs text-gray-500">PDF or DOC files only (Max 5MB)</p>
                <p *ngIf="mode === 'edit' && requirement?.attachment" class="text-xs text-blue-600 mt-1">
                  Upload new file to replace current attachment
                </p>
              </div>
              <input 
                id="requirement-file-upload" 
                type="file" 
                class="hidden" 
                accept=".pdf,.doc,.docx"
                (change)="onFileSelected($event)"
                #fileInput>
            </label>
          </div>

          <!-- Selected File Display -->
          <div *ngIf="selectedFile" class="flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-xl">
            <div class="flex items-center space-x-3">
              <img src="assets/icons/lucide/lucide/file-text.svg" alt="file" class="w-6 h-6 text-green-600" />
              <div>
                <p class="text-sm font-semibold text-green-800">{{ selectedFile.name }}</p>
                <p class="text-xs text-green-600">{{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB</p>
                <p *ngIf="mode === 'edit' && requirement?.attachment" class="text-xs text-green-500">Will replace current attachment</p>
              </div>
            </div>
            <button
              type="button"
              (click)="removeFile()"
              class="p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-all duration-200">
              <img src="assets/icons/lucide/lucide/x.svg" alt="remove" class="w-5 h-5" />
            </button>
          </div>

          <!-- Error Message -->
          <div *ngIf="fileError" class="p-4 bg-red-50 border border-red-200 rounded-xl">
            <div class="flex items-center space-x-3">
              <img src="assets/icons/lucide/lucide/alert-circle.svg" alt="error" class="w-5 h-5 text-red-600" />
              <p class="text-sm text-red-800">{{ fileError }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Footer -->
      <div class="flex items-center justify-end space-x-4 pt-6 border-t border-gray-200">
        <button
          type="button"
          (click)="onClose()"
          class="px-8 py-3 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-all duration-200 font-semibold">
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="!requirementForm.valid"
          class="px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl hover:from-purple-700 hover:to-indigo-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
          <span class="flex items-center">
            <img src="assets/icons/lucide/lucide/check.svg" alt="submit" class="w-4 h-4 mr-2" />
            {{ mode === 'create' ? 'Post Requirement' : 'Save Changes' }}
          </span>
        </button>
      </div>
    </form>
  </div>
</div>